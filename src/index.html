<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moonraker OBS Scene Changer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Flisher's Toolchanger OBS Scene Changer</h1>
    
    <div class="main-layout">
        <div class="left-column">
    <div class="status-container">
        <div id="status-moonraker" class="status disconnected">
            Moonraker: Disconnected
        </div>
        <div id="status-obs" class="status disconnected">
            OBS: Disconnected
        </div>
    </div>
        <div class="instructions hidden" id="instructions-panel">
            <h2>Quick Instructions</h2>
            <ul>
                <li>Connect OBS and Moonraker using the buttons below.</li>
                <li>Refresh scenes so the dropdowns match OBS.</li>
                <li>Use the manual switches when needed.</li>
                <li>Start the virtual camera preview to monitor the feed.</li>
            </ul>
        </div>
    <div class="config-toggle-row">
        <button id="toggle-config-btn" onclick="toggleConfig()" class="config-toggle-primary">
            ‚öôÔ∏è Configuration
        </button>
        <button id="show-instructions-btn" onclick="toggleInstructions()" class="config-toggle-secondary">
            üìò Instructions
        </button>
    </div>
    <div class="config-section" id="config-section">
        <h2>Configuration</h2>
        
        <div class="config-group">
            <h3 style="color: #ce9178; margin-bottom: 10px;">Moonraker Settings</h3>
            <label for="moonraker-host">Host:</label>
            <input type="text" id="moonraker-host" value="localhost" placeholder="e.g., 192.168.1.100">
            
            <label for="moonraker-port" style="margin-top: 10px;">Port:</label>
            <input type="number" id="moonraker-port" value="7125" placeholder="7125">
        </div>

        <div class="config-group">
            <h3 style="color: #ce9178; margin-bottom: 10px;">OBS WebSocket Settings</h3>
            <label for="obs-host">Host:</label>
            <input type="text" id="obs-host" value="localhost" placeholder="localhost">
            
            <label for="obs-port" style="margin-top: 10px;">Port:</label>
            <input type="number" id="obs-port" value="4455" placeholder="4455">
            
            <label for="obs-password" style="margin-top: 10px;">Password:</label>
            <input type="password" id="obs-password" value="" placeholder="Leave blank if no password">
        </div>

        <div class="config-group">
            <h3 style="color: #ce9178; margin-bottom: 10px;">Scene Names</h3>
            <button id="refresh-scenes-btn" onclick="refreshScenes()" style="width: auto; margin-bottom: 15px;">
                üîÑ Refresh Scenes from OBS
            </button>
            <div class="scene-input-group">
                <label for="scene-toolchanging">Tool Changing Scene:</label>
                <div style="display: flex; gap: 10px;">
                    <select id="scene-toolchanging" style="flex: 1;">
                        <option value="">-- Select Scene --</option>
                    </select>
                    <button onclick="switchToScene('toolchanging')" style="width: auto; padding: 8px 15px; margin: 0;">
                        Switch
                    </button>
                </div>
            </div>
            
            <div class="scene-input-group">
                <label for="scene-printing">Printing Scene:</label>
                <div style="display: flex; gap: 10px;">
                    <select id="scene-printing" style="flex: 1;">
                        <option value="">-- Select Scene --</option>
                    </select>
                    <button onclick="switchToScene('printing')" style="width: auto; padding: 8px 15px; margin: 0;">
                        Switch
                    </button>
                </div>
            </div>
        </div>
            <div class="scene-trigger-group">
                <label for="trigger-toolchanging">Tool Change Start Trigger:</label>
                <input type="text" id="trigger-toolchanging" value="echo: Toolchange Starting" placeholder="Tool change trigger text">
            </div>
            <div class="scene-trigger-group">
                <label for="trigger-printing">Tool Change Complete Trigger:</label>
                <input type="text" id="trigger-printing" value="echo: Toolchange Completed" placeholder="Tool change trigger text">
            </div>

        <button id="connect-btn" onclick="toggleConnection()">Connect</button>
    <div class="connection-row">
        <button id="connect-obs-btn" onclick="handleOBSConnection()">Connect OBS</button>
        <button id="connect-moonraker-btn" onclick="toggleMoonrakerConnection()">Connect Moonraker</button>
        <button id="reset-config-btn" onclick="resetConfig()" class="reset-button">Reset Configuration</button>
    </div>
            <li>Please configure your printer configurationConnect to the OBS and Moonraker services once the button becomes active.</li>
            <li>Use the refresh button to load the scene list in OBS order.</li>
            <li>Toggle the auto-switch if you want manual control over scene changes.</li>
            <li>Enable the virtual camera and preview to monitor the live feed.</li>
        </ul>
    </div>
        </div>

        <div class="right-column">
    <div class="config-section">
        <h2>Scene Control</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
            <button id="switch-toolchanging-btn" onclick="quickSwitchScene('toolchanging')" style="margin: 0;">
                üîß Tool Changing
            </button>
            <button id="switch-printing-btn" onclick="quickSwitchScene('printing')" style="margin: 0;">
                üñ®Ô∏è Printing
            </button>
        </div>
        <button id="toggle-auto-switch-btn" onclick="toggleAutoSwitch()" style="width: 100%; margin-bottom: 10px;">
            üîí Disable Auto-Switch
        </button>
    </div>

    <div class="config-section">
        <h2>Camera Preview</h2>
        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
            <button id="toggle-obs-camera-btn" onclick="toggleOBSVirtualCamera()" style="flex: 1;">Start OBS Virtual Camera</button>
            <button id="toggle-preview-btn" onclick="toggleCameraPreview()" style="flex: 1;">Show Preview</button>
        </div>
        <div id="camera-container">
            <video id="camera-preview" autoplay playsinline></video>
            <div id="camera-status">Enable OBS Virtual Camera and click "Show Preview"</div>
        </div>
    </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/obs-websocket-js@5.0.3/dist/obs-ws.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
